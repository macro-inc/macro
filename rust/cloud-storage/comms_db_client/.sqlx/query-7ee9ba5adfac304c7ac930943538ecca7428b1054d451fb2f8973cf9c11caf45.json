{
  "db_name": "PostgreSQL",
  "query": "\n        WITH input_ids AS (\n            SELECT UNNEST($1::uuid[]) AS channel_id\n        )\n        SELECT\n            i.channel_id                                          AS \"channel_id!\",\n            l.message_id                                           AS \"l_message_id?: uuid::Uuid\",\n            l.thread_id                                            AS \"l_thread_id?: uuid::Uuid\",\n            l.sender_id                                            AS \"l_sender_id?: String\",\n            l.content                                              AS \"l_content?: String\",\n            l.created_at                                           AS \"l_created_at?: chrono::DateTime<chrono::Utc>\",\n            l.updated_at                                           AS \"l_updated_at?: chrono::DateTime<chrono::Utc>\",\n            l.deleted_at                                           AS \"l_deleted_at?: chrono::DateTime<chrono::Utc>\",\n            l.mentions                                             AS \"l_mentions?: Vec<String>\",\n            n.message_id                                           AS \"n_message_id?: uuid::Uuid\",\n            n.thread_id                                            AS \"n_thread_id?: uuid::Uuid\",\n            n.sender_id                                            AS \"n_sender_id?: String\",\n            n.content                                              AS \"n_content?: String\",\n            n.created_at                                           AS \"n_created_at?: chrono::DateTime<chrono::Utc>\",\n            n.updated_at                                           AS \"n_updated_at?: chrono::DateTime<chrono::Utc>\",\n            n.deleted_at                                           AS \"n_deleted_at?: chrono::DateTime<chrono::Utc>\",\n            n.mentions                                             AS \"n_mentions?: Vec<String>\"\n        FROM input_ids i\n        LEFT JOIN LATERAL (\n            SELECT\n                m.id AS message_id,\n                m.thread_id,\n                m.sender_id,\n                m.content,\n                m.created_at,\n                m.updated_at,\n                m.deleted_at::timestamptz AS deleted_at,\n                COALESCE(\n                    ARRAY(\n                        SELECT entity_type || ':' || entity_id\n                        FROM comms_entity_mentions em\n                        WHERE em.source_entity_type = 'message'\n                          AND em.source_entity_id = m.id::text\n                    ),\n                    '{}'::text[]\n                ) AS mentions\n            FROM comms_messages m\n            WHERE m.channel_id = i.channel_id\n              AND m.deleted_at IS NULL\n            ORDER BY m.created_at DESC\n            LIMIT 1\n        ) l ON TRUE\n        LEFT JOIN LATERAL (\n            SELECT\n                m.id AS message_id,\n                m.thread_id,\n                m.sender_id,\n                m.content,\n                m.created_at,\n                m.updated_at,\n                m.deleted_at::timestamptz AS deleted_at,\n                COALESCE(\n                    ARRAY(\n                        SELECT entity_type || ':' || entity_id\n                        FROM comms_entity_mentions em\n                        WHERE em.source_entity_type = 'message'\n                          AND em.source_entity_id = m.id::text\n                    ),\n                    '{}'::text[]\n                ) AS mentions\n            FROM comms_messages m\n            WHERE m.channel_id = i.channel_id\n              AND m.deleted_at IS NULL\n              AND m.thread_id IS NULL\n            ORDER BY m.created_at DESC\n            LIMIT 1\n        ) n ON TRUE\n        ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "channel_id!",
        "type_info": "Uuid"
      },
      {
        "ordinal": 1,
        "name": "l_message_id?: uuid::Uuid",
        "type_info": "Uuid"
      },
      {
        "ordinal": 2,
        "name": "l_thread_id?: uuid::Uuid",
        "type_info": "Uuid"
      },
      {
        "ordinal": 3,
        "name": "l_sender_id?: String",
        "type_info": "Text"
      },
      {
        "ordinal": 4,
        "name": "l_content?: String",
        "type_info": "Text"
      },
      {
        "ordinal": 5,
        "name": "l_created_at?: chrono::DateTime<chrono::Utc>",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 6,
        "name": "l_updated_at?: chrono::DateTime<chrono::Utc>",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 7,
        "name": "l_deleted_at?: chrono::DateTime<chrono::Utc>",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 8,
        "name": "l_mentions?: Vec<String>",
        "type_info": "TextArray"
      },
      {
        "ordinal": 9,
        "name": "n_message_id?: uuid::Uuid",
        "type_info": "Uuid"
      },
      {
        "ordinal": 10,
        "name": "n_thread_id?: uuid::Uuid",
        "type_info": "Uuid"
      },
      {
        "ordinal": 11,
        "name": "n_sender_id?: String",
        "type_info": "Text"
      },
      {
        "ordinal": 12,
        "name": "n_content?: String",
        "type_info": "Text"
      },
      {
        "ordinal": 13,
        "name": "n_created_at?: chrono::DateTime<chrono::Utc>",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 14,
        "name": "n_updated_at?: chrono::DateTime<chrono::Utc>",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 15,
        "name": "n_deleted_at?: chrono::DateTime<chrono::Utc>",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 16,
        "name": "n_mentions?: Vec<String>",
        "type_info": "TextArray"
      }
    ],
    "parameters": {
      "Left": [
        "UuidArray"
      ]
    },
    "nullable": [
      null,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true,
      true
    ]
  },
  "hash": "7ee9ba5adfac304c7ac930943538ecca7428b1054d451fb2f8973cf9c11caf45"
}
